---
title: "Sourcebook > Rental > Assisted rental"
subtitle: "Data sources and methods"
author: "HousingForward Virginia"
date: "Updated on `r Sys.Date()`"
output:
  html_document:
    theme: lumen
    toc: true
    toc_float: true
    number_sections: true
---

# Data sources

### National Housing Preservation Database (NHPD) {-}

The National Housing Preservation Database (NHPD) is a collaboration between the
Public and Affordable Housing Research Corporation (PAHRC) and the National Low 
Income Housing Coalition (NLIHC). The database was created in 2011 and provides an
address-level inventory of federally assisted rental housing across the nation.

Data is sourced directly from the U.S. Department of Housing and Urban Development 
(HUD) and the U.S. Department of Agriculture (USDA).

Data is updated on a tri-annual basis.

# Setup
```{r setup, message=FALSE, warning=FALSE}
# Load packages and set global chunk options

library(tibble)
library(tidygeocoder)
library(tidyverse)
library(readxl)

Sys.getenv('GEOCODIO_API_KEY')

knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	eval = FALSE
)
```

# Data collection
```{r data-collect}

# Date updated: 5-29-23
va_subsidies <- read_xlsx("raw/nhpd_subsidies_va.xlsx")
  
va_subsidies <- va_subsidies %>% 
  mutate(fulladdress = paste(va_subsidies$`Street Address`, va_subsidies$`City`, va_subsidies$`State`, va_subsidies$`Zip Code`, sep = ", "))


lat_long <- va_subsidies %>%
  geocode(address = fulladdress, method = 'geocodio',
          full_results = TRUE,
          unique_only = FALSE,
          lat = lat, 
          long = long)

write_csv(lat_long, "data/va_subsidies_geocoded.csv")


```