---
title: "Sourcebook > Instability > Point-in-time"
subtitle: "Data sources and methods"
author: "HousingForward Virginia"
date: "Updated on `r Sys.Date()`"
output:
  html_document:
    theme: lumen
    toc: true
    toc_float: true
    number_sections: true
---

# Data sources

### U.S. Department of Housing and Urban Development (HUD) {-}

The U.S. Department of Housing and Urban Development requires that Continuums of
Care conduct an annual count of people experiencing homelessness who are sheltered
in an emergency shelter, transitional housing, and Safe Havens on a single night.
In addition, CoCs must also count unsheltered people experiencing homelessness every
other year (odd numbered years). These counts are referred to the Point-in-Time (PIT)
count.

HUD's definition of homelessness includes four broad categories:

* People who are living in a place not meant for human habitation, in emergency shelter, in transitional housing, or are exiting an institution where they temporarily resided. The only significant change from existing practice is that people will be considered homeless if they are exiting an institution where they resided for up to 90 days (it was previously 30 days), and were in shelter or a place not meant for human habitation immediately prior to entering that institution.
* People who are losing their primary nighttime residence, which may include a motel or hotel or a doubled up situation, within 14 days and lack resources or support networks to remain in housing. HUD had previously allowed people who were being displaced within 7 days to be considered homeless. The proposed regulation also describes specific documentation requirements for this category.
* Families with children or unaccompanied youth who are unstably housed and likely to continue in that state. This is a new category of homelessness, and it applies to families with children or unaccompanied youth who have not had a lease or ownership interest in a housing unit in the last 60 or more days, have had two or more moves in the last 60 days, and who are likely to continue to be unstably housed because of disability or multiple barriers to employment.
* People who are fleeing or attempting to flee domestic violence, have no other residence, and lack the resources or support networks to obtain other permanent housing. This category is similar to the current practice regarding people who are fleeing domestic violence.



# Setup
```{r setup}

# Load necessary packages to work with Excel file and clean it.
library(readxl)
library(janitor)
library(tidyverse)

knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	eval = FALSE
)
```


# Data collection
```{r data-collect}
# Create an object for years in character format. This is used to account for 
# sheets in the Excel file and then combine later.

years <- as.character(2007:2021)

# Create an object for the file path of the Excel file.

path <- "raw/2007-2021-PIT-Counts-by-CoC.xlsx"

# Create a function to read through each sheet and then combine them into a single
# dataframe.

full_set <- map_dfr(years, function(yr) {
  
  # Read in the dataset
  pit_set <- read_excel(path, sheet = yr) %>%
    clean_names()
  
  # Remove the year suffix from the column names
  suffix_to_remove <- paste0("_", yr)
  
  # Handle the new category column
  # Also note the use of `across()` to convert cols that should be numeric to numeric
  # which will prevent errors when row-binding the data
  if ("co_c_category" %in% names(pit_set)) {
    pit_renamed <- pit_set %>%
      rename_with(~str_remove(.x, suffix_to_remove)) %>%
      mutate(year = yr) %>%
      select(co_c_number:co_c_name, co_c_category, type_of_count, year, everything()) %>%
      mutate(across(-c(co_c_number:year), .fns = as.numeric))
  } else {
    pit_renamed <- pit_set %>%
      rename_with(~str_remove(.x, suffix_to_remove)) %>%
      mutate(year = yr, co_c_category = NA_character_, 
             type_of_count = NA_character_) %>%
      select(co_c_number:co_c_name, co_c_category, type_of_count, year, everything()) %>%
      mutate(across(-c(co_c_number:year), .fns = as.numeric))
  }
  
  
  
  pit_renamed
  
})

# An alternative approach, with a "category" column to reduce the large number of columns:
full_set_longer <- full_set %>%
  pivot_longer(
    cols = overall_homeless:unsheltered_homeless_parenting_youth_under_25_multiple_races, 
    names_to = "category",
    values_to = "value"
  )
```

# Data export
```{r data-export}
# write the file to csv.

write_csv(full_set_longer, "data/va_pit_2007_2021.csv")
```

