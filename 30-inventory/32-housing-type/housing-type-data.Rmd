---
title: "Sourcebook > Inventory > Housing type"
subtitle: "Data sources and methods"
author: "HousingForward Virginia"
date: "Updated on `r Sys.Date()`"
output:
  html_document:
    theme: lumen
    toc: true
    toc_float: true
    number_sections: true
---

# Data sources

### American Community Survey (ACS) {-}

The American Community Survey is an ongoing survey program of the U.S. Census Bureau. The ACS collects information about the nationâ€™s social, economic, housing, and demographic characteristics on an annual basis. This information provides the most-up-to-date estimates between decennial censuses.

This section uses data from one ACS table:

* **Table B25032**: Tenure by Units in Structure

The most recent data used for this section are the **2015-2019 5-year estimates**. These estimates average all survey responses across this period to increase sample sizes and reduce margins of error.

Link: https://www.census.gov/programs-surveys/acs

# Setup

```{r setup, message=FALSE, warning=FALSE}

# Load packages and set global chunk options

library(tidycensus)
library(tidyverse)

knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)

```

# Data collection

```{r collect}

# Get variables for Table B25032

b25032_vars <- load_variables(2021, "acs5") %>% 
  filter(str_detect(name, "B25032")) %>% 
  filter(str_length(name) == 10)

# Get B25032 data for every locality in Virginia

b25032_raw <- get_acs(
  geography = "county",
  state = "VA",
  table = "B25032",
  year = 2021
)

```

# Data prep

```{r prep}

# Clean B25032 variable names

b25032_vars_clean <-  b25032_vars %>% 
  separate(label, into = c("est", "tot", "tenure", "type"),
           sep = "!!") %>% 
  select(variable = name, tenure, type) %>%
  filter(across(c(tenure, type), ~!is.na(.x))) %>% 
  mutate(across(.fns = ~str_remove_all(.x, ":")),
         tenure = str_remove_all(tenure, "-occupied housing units")) %>% 
  mutate(type = case_when(
    type == "1, detached" ~ "Single-family (detached)",
    type == "1, attached" ~ "Single-family (attached)",
    type == "2" ~ "Small-scale multifamily",
    type == "3 or 4" ~ "Small-scale multifamily",
    type == "5 to 9" ~ "Small-scale multifamily",
    type == "10 to 19" ~ "Small-scale multifamily",
    type == "20 to 49" ~ "Medium-scale multifamily",
    type == "50 or more" ~ "Large-scale multifamily",
    type == "Mobile home" ~ "Mobile (manufactured) home",
    type == "Boat, RV, van, etc." ~ "Other")
  )

# Join B25032 variables to data and calculate new sums

b25032_prep <- b25032_raw %>% 
  right_join(b25032_vars_clean, by = "variable") %>% 
  select(GEOID, tenure, type, estimate, moe) %>% 
  group_by(GEOID, tenure, type) %>% 
  summarise(
    estimate = sum(estimate),
    moe = moe_sum(moe, estimate)
  ) %>% 
  ungroup()

# Adorn subtotals for both owner and renter units and add data reliability info

b25032_data <- b25032_prep %>% 
  bind_rows(b25032_prep %>%  
    group_by(GEOID, type) %>% 
    summarise(
      estimate = sum(estimate),
      moe = moe_sum(moe, estimate)) %>% 
    ungroup()
  ) %>% 
  mutate(tenure = replace_na(tenure, "All")) %>% 
  mutate(cv = ((moe/1.645)/estimate)*100) %>% # Calculate coefficient of variation
  mutate(reliability = case_when(
    cv < 15 ~ "High",
    cv >= 15 & cv <= 30 ~ "Medium",
    cv > 30 ~ "Low")
  )

```

# Data export

```{r export}

# Save housing type data from B25032

write_csv(b25032_data, "data/housing-type.csv")

```

# Dashboard development

Reserved for future Shiny app development.